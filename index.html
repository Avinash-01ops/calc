<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<title>Trip Logger</title>
	<link rel="stylesheet" href="styles.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

	<!-- Supabase CDN - Load first -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js" defer></script>
</head>
<body>
	<header class="app-header">
		<h1>Trip Logger</h1>
		<nav class="top-tabs" id="top-tabs">
			<button data-view="logs" class="top-tab active">Logs</button>
			<button data-view="analytics" class="top-tab">Analytics</button>
		</nav>
	</header>

	<main class="content">
		<section class="logs-view" id="logs-view">
			<div>

			</div>
			<div class="list-controls">
				<div class="filters" id="logFilters">
					<button class="chip active" data-filter="all">All</button>
					<button class="chip" data-filter="trip">Money</button>
					<button class="chip" data-filter="fuel">Fuel</button>
				</div>
				<div class="sort">
					<select id="logSort">
						<option value="desc" selected>Newest</option>
						<option value="asc">Oldest</option>
					</select>
				</div>
			</div>
			<section class="trip-list" id="trip-list">
				<h2>Recent Trips</h2>
				<ul id="trips"></ul>
			</section>
		</section>

		<section class="analytics hidden" id="analytics">
			<div class="period-tabs" id="period-tabs">
				<button data-period="today" class="tab active">Today</button>
				<button data-period="week" class="tab">Weekly</button>
				<button data-period="month" class="tab">Monthly</button>
			</div>
			<div class="range-controls" style="justify-content:flex-end">
                <button id="btnRangeOpen" class="chip" aria-label="Custom range">Custom range</button>
			</div>
			<div class="cards">
				<div class="card"><span class="label">Distance</span><span class="value" id="stat-distance">0 km</span></div>
                <div class="card"><span class="label">Received</span><span class="value" id="stat-received">0</span></div>
				<div class="card"><span class="label">Fuel Used</span><span class="value" id="stat-fuel-est">0 l</span></div>
                <div class="card"><span class="label">Fuel Cost</span><span class="value" id="stat-fuel-cost-est">0</span></div>
			</div>
		</section>

		<!-- Range picker small sheet -->
		<div id="rangeSheet" class="sheet hidden" aria-modal="true" role="dialog" aria-labelledby="rangeTitle">
			<div class="sheet-handle"></div>
			<div class="sheet-content">
				<h3 id="rangeTitle">Select range</h3>
				<div class="date-row">
					<input type="date" id="rangeStart">
					<span class="range-sep">to</span>
					<input type="date" id="rangeEnd">
				</div>
				<div class="sheet-actions">
					<button type="button" id="rangeCancel" class="btn ghost">Cancel</button>
					<button type="button" id="rangeApply" class="btn primary">Apply</button>
				</div>
			</div>
		</div>

	</main>

	<button id="fab-add" class="fab" aria-label="Add trip">+</button>

	<div id="toast" class="toast" role="status" aria-live="polite"></div>

	<div id="sheet" class="sheet hidden" role="dialog" aria-modal="true" aria-labelledby="sheet-title">
		<div class="sheet-handle" id="sheet-handle"></div>
		<div class="sheet-content">
			<h3 id="sheet-title">Add Trip</h3>
			<form id="trip-form">
				<div class="entry-type-tabs" id="entryTypeTabs">
					<button type="button" data-type="trip" class="etype active">Trip</button>
					<button type="button" data-type="fuel" class="etype">Fuel</button>
				</div>
				<label>
					<span>Date</span>
					<div class="date-row">
						<input type="date" id="tripDate" required>
					</div>
				</label>
				<div id="tripFields">
					<label>
						<span>Odometer (current)</span>
						<input type="number" inputmode="numeric" id="kmReading" min="0">
						<small class="hint" id="prevHint"></small>
						<small class="hint" id="distancePreview"></small>
					</label>
					<label>
						<span>Amount Received</span>
						<input type="number" inputmode="decimal" id="amountReceived" min="0" step="0.01">
					</label>
				</div>

				<div id="fuelFields" class="hidden">
					<label>
						<span>Odometer (at refuel)</span>
						<input type="number" inputmode="numeric" id="fuelOdo" min="0">
					</label>
					<label>
						<span>Fuel</span>
						<input type="number" inputmode="decimal" id="fuelLiters" min="0" step="0.01">
					</label>
					<label>
						<span>Fuel Cost</span>
						<input type="number" inputmode="decimal" id="fuelCost" min="0" step="0.01">
					</label>
				</div>
				<div class="sheet-actions">
					<button type="button" id="cancelBtn" class="btn ghost">Cancel</button>
					<button type="submit" class="btn primary">Save</button>
				</div>
			</form>
		</div>
	</div>

	<script>
		// Debug: Check if Supabase is loaded
		window.addEventListener('load', function() {
			console.log('Page loaded, checking Supabase...');
            if (typeof window.supabase !== 'undefined') {
                console.log('Supabase loaded as window.supabase');
            } else if (typeof supabase !== 'undefined') {
                console.log('Supabase loaded as global supabase');
            } else {
                console.log('Supabase not found in global scope');
            }
		});
	</script>
	<script type="module" src="app.js"></script>
</body>
</html>

